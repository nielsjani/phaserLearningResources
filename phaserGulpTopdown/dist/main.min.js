(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"d:\\phaserGulpTopdown\\src\\js\\main.js":[function(require,module,exports){
var TopDownGame = TopDownGame || {};

TopDownGame.game = new Phaser.Game(160, 160, Phaser.AUTO, '');

TopDownGame.game.state.add('Boot', require('./states/boot'));
TopDownGame.game.state.add('Preload', require('./states/preload'));
TopDownGame.game.state.add('Game', require('./states/game'));

TopDownGame.game.state.start('Boot');
},{"./states/boot":"d:\\phaserGulpTopdown\\src\\js\\states\\boot.js","./states/game":"d:\\phaserGulpTopdown\\src\\js\\states\\game.js","./states/preload":"d:\\phaserGulpTopdown\\src\\js\\states\\preload.js"}],"d:\\phaserGulpTopdown\\src\\js\\states\\boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

//setting game configuration and loading the assets for the loading screen
Boot.prototype = {
  preload: function() {
    //assets we'll use in the loading screen
    this.load.image('preloadbar', 'assets/images/preloader-bar.png');
  },
  create: function() {
    //loading screen will have a white background
    this.game.stage.backgroundColor = '#fff';

    //scaling options
    this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
    
    //have the game centered horizontally
    this.scale.pageAlignHorizontally = true;
    this.scale.pageAlignVertically = true;

    //physics system
    this.game.physics.startSystem(Phaser.Physics.ARCADE);
    
    this.state.start('Preload');
  }
};

},{}],"d:\\phaserGulpTopdown\\src\\js\\states\\game.js":[function(require,module,exports){
var Game = function () {
};

module.exports = Game;

Game.prototype = {
    create: function () {
        console.log("GAME");
        this.map = this.game.add.tilemap('level1');
        console.log("GAME: added tilemap");

        //the first parameter is the tileset name as specified in Tiled, the second is the key to the asset
        this.map.addTilesetImage('tiles', 'gameTiles');
        console.log("GAME: added tilesetimg");

        //create layer
        this.backgroundlayer = this.map.createLayer('backgroundLayer');
        this.blockedLayer = this.map.createLayer('blockedLayer');

        //collision on blockedLayer
        this.map.setCollisionBetween(1, 100000, true, 'blockedLayer');

        //resizes the game world to match the layer dimensions
        this.backgroundlayer.resizeWorld();

        this.createItems();
        this.createDoors();

        //create player
        var result = this.findObjectsByType('playerStart', this.map, 'objectsLayer');

        //we know there is just one result
        this.player = this.game.add.sprite(result[0].x, result[0].y, 'player');
        this.game.physics.arcade.enable(this.player);

        //the camera will follow the player in the world
        this.game.camera.follow(this.player);

        //move player with cursor keys
        this.cursors = this.game.input.keyboard.createCursorKeys();
    },
    collect: function(player, collectable) {
        console.log('yummy!');

        //remove sprite
        collectable.destroy();
    },
    enterDoor: function(player, door) {
        console.log('entering door that will take you to '+door.targetTilemap+' on x:'+door.targetX+' and y:'+door.targetY);
    },
    update: function () {
        //collision
        this.game.physics.arcade.collide(this.player, this.blockedLayer);
        this.game.physics.arcade.overlap(this.player, this.items, this.collect, null, this);
        this.game.physics.arcade.overlap(this.player, this.doors, this.enterDoor, null, this);

        //player movement
        this.player.body.velocity.y = 0;
        this.player.body.velocity.x = 0;

        if (this.cursors.up.isDown) {
            this.player.body.velocity.y -= 50;
        }
        else if (this.cursors.down.isDown) {
            this.player.body.velocity.y += 50;
        }
        if (this.cursors.left.isDown) {
            this.player.body.velocity.x -= 50;
        }
        else if (this.cursors.right.isDown) {
            this.player.body.velocity.x += 50;
        }
    },
    createItems: function () {
        //create items
        this.items = this.game.add.group();
        this.items.enableBody = true;
        var item;
        result = this.findObjectsByType('item', this.map, 'objectsLayer');
        result.forEach(function (element) {
            this.createFromTiledObject(element, this.items);
        }, this);
    },
    createDoors: function () {
        //create doors
        this.doors = this.game.add.group();
        this.doors.enableBody = true;
        result = this.findObjectsByType('door', this.map, 'objectsLayer');

        result.forEach(function (element) {
            this.createFromTiledObject(element, this.doors);
        }, this);
    },
    //create a sprite from an object
    createFromTiledObject: function (element, group) {
        var sprite = group.create(element.x, element.y, element.properties.sprite);

        //copy all properties to the sprite
        Object.keys(element.properties).forEach(function (key) {
            sprite[key] = element.properties[key];
        });
    },
    //find objects in a Tiled layer that containt a property called "type" equal to a certain value
    findObjectsByType: function (type, map, layer) {
        var result = [];
        map.objects[layer].forEach(function (element) {
            if (element.properties.type === type) {
                //Phaser uses top left, Tiled bottom left so we have to adjust the y position
                //also keep in mind that the cup images are a bit smaller than the tile which is 16x16
                //so they might not be placed in the exact pixel position as in Tiled
                element.y -= map.tileHeight;
                result.push(element);
            }
        });
        return result;
    }
};
},{}],"d:\\phaserGulpTopdown\\src\\js\\states\\preload.js":[function(require,module,exports){
var Preload = function () {};

module.exports = Preload;


Preload.prototype = {
  preload: function() {
    //show loading screen
    this.preloadBar = this.add.sprite(this.game.world.centerX, this.game.world.centerY, 'preloadbar');
    this.preloadBar.anchor.setTo(0.5);

    this.load.setPreloadSprite(this.preloadBar);

    //load game assets
    this.load.tilemap('level1', 'assets/tilemaps/level1.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.image('gameTiles', 'assets/images/tiles.png');
    this.load.image('greencup', 'assets/images/greencup.png');
    this.load.image('bluecup', 'assets/images/bluecup.png');
    this.load.image('player', 'assets/images/player.png');
    this.load.image('browndoor', 'assets/images/browndoor.png');
    
  },
  create: function() {
    this.state.start('Game');
  }
};
},{}]},{},["d:\\phaserGulpTopdown\\src\\js\\main.js"])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9zdGF0ZXMvYm9vdC5qcyIsInNyYy9qcy9zdGF0ZXMvZ2FtZS5qcyIsInNyYy9qcy9zdGF0ZXMvcHJlbG9hZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsInZhciBUb3BEb3duR2FtZSA9IFRvcERvd25HYW1lIHx8IHt9O1xuXG5Ub3BEb3duR2FtZS5nYW1lID0gbmV3IFBoYXNlci5HYW1lKDE2MCwgMTYwLCBQaGFzZXIuQVVUTywgJycpO1xuXG5Ub3BEb3duR2FtZS5nYW1lLnN0YXRlLmFkZCgnQm9vdCcsIHJlcXVpcmUoJy4vc3RhdGVzL2Jvb3QnKSk7XG5Ub3BEb3duR2FtZS5nYW1lLnN0YXRlLmFkZCgnUHJlbG9hZCcsIHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWQnKSk7XG5Ub3BEb3duR2FtZS5nYW1lLnN0YXRlLmFkZCgnR2FtZScsIHJlcXVpcmUoJy4vc3RhdGVzL2dhbWUnKSk7XG5cblRvcERvd25HYW1lLmdhbWUuc3RhdGUuc3RhcnQoJ0Jvb3QnKTsiLCJ2YXIgQm9vdCA9IGZ1bmN0aW9uICgpIHt9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3Q7XG5cbi8vc2V0dGluZyBnYW1lIGNvbmZpZ3VyYXRpb24gYW5kIGxvYWRpbmcgdGhlIGFzc2V0cyBmb3IgdGhlIGxvYWRpbmcgc2NyZWVuXG5Cb290LnByb3RvdHlwZSA9IHtcbiAgcHJlbG9hZDogZnVuY3Rpb24oKSB7XG4gICAgLy9hc3NldHMgd2UnbGwgdXNlIGluIHRoZSBsb2FkaW5nIHNjcmVlblxuICAgIHRoaXMubG9hZC5pbWFnZSgncHJlbG9hZGJhcicsICdhc3NldHMvaW1hZ2VzL3ByZWxvYWRlci1iYXIucG5nJyk7XG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgLy9sb2FkaW5nIHNjcmVlbiB3aWxsIGhhdmUgYSB3aGl0ZSBiYWNrZ3JvdW5kXG4gICAgdGhpcy5nYW1lLnN0YWdlLmJhY2tncm91bmRDb2xvciA9ICcjZmZmJztcblxuICAgIC8vc2NhbGluZyBvcHRpb25zXG4gICAgdGhpcy5zY2FsZS5zY2FsZU1vZGUgPSBQaGFzZXIuU2NhbGVNYW5hZ2VyLlNIT1dfQUxMO1xuICAgIFxuICAgIC8vaGF2ZSB0aGUgZ2FtZSBjZW50ZXJlZCBob3Jpem9udGFsbHlcbiAgICB0aGlzLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgdGhpcy5zY2FsZS5wYWdlQWxpZ25WZXJ0aWNhbGx5ID0gdHJ1ZTtcblxuICAgIC8vcGh5c2ljcyBzeXN0ZW1cbiAgICB0aGlzLmdhbWUucGh5c2ljcy5zdGFydFN5c3RlbShQaGFzZXIuUGh5c2ljcy5BUkNBREUpO1xuICAgIFxuICAgIHRoaXMuc3RhdGUuc3RhcnQoJ1ByZWxvYWQnKTtcbiAgfVxufTtcbiIsInZhciBHYW1lID0gZnVuY3Rpb24gKCkge1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBHYW1lO1xyXG5cclxuR2FtZS5wcm90b3R5cGUgPSB7XHJcbiAgICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkdBTUVcIik7XHJcbiAgICAgICAgdGhpcy5tYXAgPSB0aGlzLmdhbWUuYWRkLnRpbGVtYXAoJ2xldmVsMScpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiR0FNRTogYWRkZWQgdGlsZW1hcFwiKTtcclxuXHJcbiAgICAgICAgLy90aGUgZmlyc3QgcGFyYW1ldGVyIGlzIHRoZSB0aWxlc2V0IG5hbWUgYXMgc3BlY2lmaWVkIGluIFRpbGVkLCB0aGUgc2Vjb25kIGlzIHRoZSBrZXkgdG8gdGhlIGFzc2V0XHJcbiAgICAgICAgdGhpcy5tYXAuYWRkVGlsZXNldEltYWdlKCd0aWxlcycsICdnYW1lVGlsZXMnKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkdBTUU6IGFkZGVkIHRpbGVzZXRpbWdcIik7XHJcblxyXG4gICAgICAgIC8vY3JlYXRlIGxheWVyXHJcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kbGF5ZXIgPSB0aGlzLm1hcC5jcmVhdGVMYXllcignYmFja2dyb3VuZExheWVyJyk7XHJcbiAgICAgICAgdGhpcy5ibG9ja2VkTGF5ZXIgPSB0aGlzLm1hcC5jcmVhdGVMYXllcignYmxvY2tlZExheWVyJyk7XHJcblxyXG4gICAgICAgIC8vY29sbGlzaW9uIG9uIGJsb2NrZWRMYXllclxyXG4gICAgICAgIHRoaXMubWFwLnNldENvbGxpc2lvbkJldHdlZW4oMSwgMTAwMDAwLCB0cnVlLCAnYmxvY2tlZExheWVyJyk7XHJcblxyXG4gICAgICAgIC8vcmVzaXplcyB0aGUgZ2FtZSB3b3JsZCB0byBtYXRjaCB0aGUgbGF5ZXIgZGltZW5zaW9uc1xyXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZGxheWVyLnJlc2l6ZVdvcmxkKCk7XHJcblxyXG4gICAgICAgIHRoaXMuY3JlYXRlSXRlbXMoKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZURvb3JzKCk7XHJcblxyXG4gICAgICAgIC8vY3JlYXRlIHBsYXllclxyXG4gICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmZpbmRPYmplY3RzQnlUeXBlKCdwbGF5ZXJTdGFydCcsIHRoaXMubWFwLCAnb2JqZWN0c0xheWVyJyk7XHJcblxyXG4gICAgICAgIC8vd2Uga25vdyB0aGVyZSBpcyBqdXN0IG9uZSByZXN1bHRcclxuICAgICAgICB0aGlzLnBsYXllciA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKHJlc3VsdFswXS54LCByZXN1bHRbMF0ueSwgJ3BsYXllcicpO1xyXG4gICAgICAgIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGUodGhpcy5wbGF5ZXIpO1xyXG5cclxuICAgICAgICAvL3RoZSBjYW1lcmEgd2lsbCBmb2xsb3cgdGhlIHBsYXllciBpbiB0aGUgd29ybGRcclxuICAgICAgICB0aGlzLmdhbWUuY2FtZXJhLmZvbGxvdyh0aGlzLnBsYXllcik7XHJcblxyXG4gICAgICAgIC8vbW92ZSBwbGF5ZXIgd2l0aCBjdXJzb3Iga2V5c1xyXG4gICAgICAgIHRoaXMuY3Vyc29ycyA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5jcmVhdGVDdXJzb3JLZXlzKCk7XHJcbiAgICB9LFxyXG4gICAgY29sbGVjdDogZnVuY3Rpb24ocGxheWVyLCBjb2xsZWN0YWJsZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCd5dW1teSEnKTtcclxuXHJcbiAgICAgICAgLy9yZW1vdmUgc3ByaXRlXHJcbiAgICAgICAgY29sbGVjdGFibGUuZGVzdHJveSgpO1xyXG4gICAgfSxcclxuICAgIGVudGVyRG9vcjogZnVuY3Rpb24ocGxheWVyLCBkb29yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2VudGVyaW5nIGRvb3IgdGhhdCB3aWxsIHRha2UgeW91IHRvICcrZG9vci50YXJnZXRUaWxlbWFwKycgb24geDonK2Rvb3IudGFyZ2V0WCsnIGFuZCB5OicrZG9vci50YXJnZXRZKTtcclxuICAgIH0sXHJcbiAgICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvL2NvbGxpc2lvblxyXG4gICAgICAgIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5jb2xsaWRlKHRoaXMucGxheWVyLCB0aGlzLmJsb2NrZWRMYXllcik7XHJcbiAgICAgICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLm92ZXJsYXAodGhpcy5wbGF5ZXIsIHRoaXMuaXRlbXMsIHRoaXMuY29sbGVjdCwgbnVsbCwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLm92ZXJsYXAodGhpcy5wbGF5ZXIsIHRoaXMuZG9vcnMsIHRoaXMuZW50ZXJEb29yLCBudWxsLCB0aGlzKTtcclxuXHJcbiAgICAgICAgLy9wbGF5ZXIgbW92ZW1lbnRcclxuICAgICAgICB0aGlzLnBsYXllci5ib2R5LnZlbG9jaXR5LnkgPSAwO1xyXG4gICAgICAgIHRoaXMucGxheWVyLmJvZHkudmVsb2NpdHkueCA9IDA7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmN1cnNvcnMudXAuaXNEb3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmJvZHkudmVsb2NpdHkueSAtPSA1MDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5jdXJzb3JzLmRvd24uaXNEb3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmJvZHkudmVsb2NpdHkueSArPSA1MDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY3Vyc29ycy5sZWZ0LmlzRG93bikge1xyXG4gICAgICAgICAgICB0aGlzLnBsYXllci5ib2R5LnZlbG9jaXR5LnggLT0gNTA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuY3Vyc29ycy5yaWdodC5pc0Rvd24pIHtcclxuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYm9keS52ZWxvY2l0eS54ICs9IDUwO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBjcmVhdGVJdGVtczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vY3JlYXRlIGl0ZW1zXHJcbiAgICAgICAgdGhpcy5pdGVtcyA9IHRoaXMuZ2FtZS5hZGQuZ3JvdXAoKTtcclxuICAgICAgICB0aGlzLml0ZW1zLmVuYWJsZUJvZHkgPSB0cnVlO1xyXG4gICAgICAgIHZhciBpdGVtO1xyXG4gICAgICAgIHJlc3VsdCA9IHRoaXMuZmluZE9iamVjdHNCeVR5cGUoJ2l0ZW0nLCB0aGlzLm1hcCwgJ29iamVjdHNMYXllcicpO1xyXG4gICAgICAgIHJlc3VsdC5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJvbVRpbGVkT2JqZWN0KGVsZW1lbnQsIHRoaXMuaXRlbXMpO1xyXG4gICAgICAgIH0sIHRoaXMpO1xyXG4gICAgfSxcclxuICAgIGNyZWF0ZURvb3JzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy9jcmVhdGUgZG9vcnNcclxuICAgICAgICB0aGlzLmRvb3JzID0gdGhpcy5nYW1lLmFkZC5ncm91cCgpO1xyXG4gICAgICAgIHRoaXMuZG9vcnMuZW5hYmxlQm9keSA9IHRydWU7XHJcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5maW5kT2JqZWN0c0J5VHlwZSgnZG9vcicsIHRoaXMubWFwLCAnb2JqZWN0c0xheWVyJyk7XHJcblxyXG4gICAgICAgIHJlc3VsdC5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJvbVRpbGVkT2JqZWN0KGVsZW1lbnQsIHRoaXMuZG9vcnMpO1xyXG4gICAgICAgIH0sIHRoaXMpO1xyXG4gICAgfSxcclxuICAgIC8vY3JlYXRlIGEgc3ByaXRlIGZyb20gYW4gb2JqZWN0XHJcbiAgICBjcmVhdGVGcm9tVGlsZWRPYmplY3Q6IGZ1bmN0aW9uIChlbGVtZW50LCBncm91cCkge1xyXG4gICAgICAgIHZhciBzcHJpdGUgPSBncm91cC5jcmVhdGUoZWxlbWVudC54LCBlbGVtZW50LnksIGVsZW1lbnQucHJvcGVydGllcy5zcHJpdGUpO1xyXG5cclxuICAgICAgICAvL2NvcHkgYWxsIHByb3BlcnRpZXMgdG8gdGhlIHNwcml0ZVxyXG4gICAgICAgIE9iamVjdC5rZXlzKGVsZW1lbnQucHJvcGVydGllcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgICAgIHNwcml0ZVtrZXldID0gZWxlbWVudC5wcm9wZXJ0aWVzW2tleV07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgLy9maW5kIG9iamVjdHMgaW4gYSBUaWxlZCBsYXllciB0aGF0IGNvbnRhaW50IGEgcHJvcGVydHkgY2FsbGVkIFwidHlwZVwiIGVxdWFsIHRvIGEgY2VydGFpbiB2YWx1ZVxyXG4gICAgZmluZE9iamVjdHNCeVR5cGU6IGZ1bmN0aW9uICh0eXBlLCBtYXAsIGxheWVyKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIG1hcC5vYmplY3RzW2xheWVyXS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50LnByb3BlcnRpZXMudHlwZSA9PT0gdHlwZSkge1xyXG4gICAgICAgICAgICAgICAgLy9QaGFzZXIgdXNlcyB0b3AgbGVmdCwgVGlsZWQgYm90dG9tIGxlZnQgc28gd2UgaGF2ZSB0byBhZGp1c3QgdGhlIHkgcG9zaXRpb25cclxuICAgICAgICAgICAgICAgIC8vYWxzbyBrZWVwIGluIG1pbmQgdGhhdCB0aGUgY3VwIGltYWdlcyBhcmUgYSBiaXQgc21hbGxlciB0aGFuIHRoZSB0aWxlIHdoaWNoIGlzIDE2eDE2XHJcbiAgICAgICAgICAgICAgICAvL3NvIHRoZXkgbWlnaHQgbm90IGJlIHBsYWNlZCBpbiB0aGUgZXhhY3QgcGl4ZWwgcG9zaXRpb24gYXMgaW4gVGlsZWRcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQueSAtPSBtYXAudGlsZUhlaWdodDtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxufTsiLCJ2YXIgUHJlbG9hZCA9IGZ1bmN0aW9uICgpIHt9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByZWxvYWQ7XG5cblxuUHJlbG9hZC5wcm90b3R5cGUgPSB7XG4gIHByZWxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgIC8vc2hvdyBsb2FkaW5nIHNjcmVlblxuICAgIHRoaXMucHJlbG9hZEJhciA9IHRoaXMuYWRkLnNwcml0ZSh0aGlzLmdhbWUud29ybGQuY2VudGVyWCwgdGhpcy5nYW1lLndvcmxkLmNlbnRlclksICdwcmVsb2FkYmFyJyk7XG4gICAgdGhpcy5wcmVsb2FkQmFyLmFuY2hvci5zZXRUbygwLjUpO1xuXG4gICAgdGhpcy5sb2FkLnNldFByZWxvYWRTcHJpdGUodGhpcy5wcmVsb2FkQmFyKTtcblxuICAgIC8vbG9hZCBnYW1lIGFzc2V0c1xuICAgIHRoaXMubG9hZC50aWxlbWFwKCdsZXZlbDEnLCAnYXNzZXRzL3RpbGVtYXBzL2xldmVsMS5qc29uJywgbnVsbCwgUGhhc2VyLlRpbGVtYXAuVElMRURfSlNPTik7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdnYW1lVGlsZXMnLCAnYXNzZXRzL2ltYWdlcy90aWxlcy5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2dyZWVuY3VwJywgJ2Fzc2V0cy9pbWFnZXMvZ3JlZW5jdXAucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdibHVlY3VwJywgJ2Fzc2V0cy9pbWFnZXMvYmx1ZWN1cC5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3BsYXllcicsICdhc3NldHMvaW1hZ2VzL3BsYXllci5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2Jyb3duZG9vcicsICdhc3NldHMvaW1hZ2VzL2Jyb3duZG9vci5wbmcnKTtcbiAgICBcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnN0YXRlLnN0YXJ0KCdHYW1lJyk7XG4gIH1cbn07Il19
